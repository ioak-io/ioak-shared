_format_version: "3.0"
_transform: true

services:
  - name: auth-service
    url: http://auth-service:2000
    routes:
      - name: auth-route
        paths:
          - /auth
        strip_path: true

  - name: express-service
    url: http://express-service:3000
    routes:
      - name: express-route
        paths:
          - /express
        strip_path: true
    plugins:
      - name: jwt
        enabled: true
        config:
          key_claim_name: kid
          claims_to_verify: [exp]
      - name: request-transformer
        config:
          add:
            headers:
              - "x-jwt-iss:$(jwt_claim_iss)"
              - "x-jwt-aud:$(jwt_claim_aud)"
              - "x-jwt-azp:$(jwt_claim_azp)"
              - "x-jwt-sub:$(jwt_claim_sub)"
              - "x-jwt-typ:$(jwt_claim_typ)"
              - "x-jwt-sid:$(jwt_claim_sid)"

consumers:
  - username: keycloak-consumer
    jwt_secrets:
      - algorithm: RS256
        key: echo
        rsa_public_key: |
          -----BEGIN PUBLIC KEY-----
          MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAuGRG8ZiYLD4eHmECcSZR
          xl5n19Y8vvpcqQwl/9+InI/yCxrVB9DX/dPeWXDsgeIpm/B2ZQAFBdh5IaWTCooH
          c2PBcksoidxaCM7b+sq2mo/Ay+kUnQM7I5PYELjKHIbzYjlmozF2ilvsxph/YwlV
          L/GAb9eu0vZnd7lCbrIknGE/qvQxSCj2vl4Qal0SyEXz4hklAxf8zInK2LgOlnxq
          uMt/MpY4CC9AVNicd7cBqckR4eU4qN0zXQB0USUkekHZImi24eZxqpel+mMMwAt0
          AdGg58lmWbfCcYfNVjBYkt6NkJKDu9WX2/mJVF6SGhjOyde/t0dU3oNk9ryNgzjW
          oQIDAQAB
          -----END PUBLIC KEY-----
